| 用例名称 | 前置测试条件 | 操作步骤 | 预期结果 |
|:-----|:-----|:-----|:-----|
| 绑定第一台DECO | 1. DUT恢复出厂设置。 | 1. 在DECO串口下通过指令“echo '{"config_version":"1482213341007","params":{"nickname":{"nickname":"living_room"},"date_time":{"time":1428804080351,"timezone":480,"tz_region":"China/Shanghai"},"wireless":{"ssid":"QEBsc3dsZGxlZGU=","password":"OTg3NjU0MzIx"},"cloud_account":{"username":"d2VuZ2thaXBpbmdAdHAtbGluay5jb20uY24=","password":"MTIzNDU2Nzg="}}}' &#124; tmpcli -o 0x4020”绑定第一台设备。 | 1.查看group-info分区，已生成group-info,role为“AP”.<br>2.“cat /etc/config/bind_device_list”,可以看到绑定设备列表中存在第一台DECO.<br>3.执行ubus call sync list和cat /tmp/sync-server/mesh_dev_list确认在线设备列表更新。<br>4.ls /etc/dropbear/确认已根据group-key更新ssh key. |
| 同步未绑定DECO信息 | 1. 两台DECO设备处于出厂状态下。<br>2. 两台DECO通过预连接组网成功。 | 1.作为RE的DECO连接上获取到IP后smartip hotplug触发sync probe。<br>2.分别在两个DECO串口下ubus call sync list<br>3.绑定第一台DECO，查看ubus call sync list变化。| 1.步骤2看到设备列表中存在两个DECO，role为“UNBIND”。<br>2.步骤3在AP上仍然可以看到两个DECO，/tmp/sync-server/unbind_dev_list可以看到未绑定的DECO。而在未绑定的DECO上AP的信息逐渐超时消失。|
| 绑定第二台DECO | 1. 一台DECO已绑定，另一台DECO设备处于出厂状态下。<br>2. 两台DECO通过预连接组网成功。 | 1. 在AP串口执行echo '{"config_version":"1482213341008", "params":{"cloud_account":{"username":"d2VuZ2thaXBpbmdAdHAtbGluay5jb20uY24=", "password":"MTIzNDU2Nzg="},"device_list":[{"device_id":"801922409E9C91131EDEA9E0C519E6C71806798A","nickname":{"nickname":"bedroom"}}]}}' &#124; tmpcli -o 0x420B，以绑定第一台设备。<br>2. 绑定期间在AP上执行ubus call sync probe | 1.步骤1看到RE上生成group-info，AP的bind_device_list上添加了RE的信息。<br>2.步骤2在AP未收到RE回复更新bind_device_list前，即使发现对端配置版本较低也不进行配置同步。<br>3.稍等一会，RE从AP上同步配置。|
| 解绑第二台DECO | 1. 两台DECO已绑定成功。<br>2. 两台DECO组网成功。 | 1. 在AP串口执行echo '{"params":{"device_list":[{"device_id":"801922409E9C91131EDEA9E0C519E6C71806798A"}]}}' &#124; tmpcli -o 0x4022 以解绑RE。 | 1.步骤1看到RE恢复出厂重启，AP的bind_device_list上删除了RE的信息。
| reset RE | 1. 两台DECO已绑定成功。<br>2. 两台DECO组网成功。 | 1. RE手动恢复出厂之后通过预连接接入AP.<br>2. 两台DECO同步信息。 | 1.AP发现RE的groupinfo为默认值，从bind_device_list中删除条目。
| 重新指定网关 | 1. 两台DECO已绑定成功。<br>2. 两台DECO组网成功。 | 串口下执行echo '{"config_version":"1482213341100","params":{ "device_id":"801922409E9C91131EDEA9E0C519E6C71806798A"}}' &#124; tmpcli -o 0x420F | 1.新指定的AP的role切换为AP。